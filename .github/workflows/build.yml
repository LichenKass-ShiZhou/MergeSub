name: Build linuxdeployqt

on:
  # 允许手动触发工作流
  workflow_dispatch:
    # 可选的输入参数
    inputs:
      build-type:
        description: '构建类型'
        required: false
        default: 'release'
        type: choice
        options:
          - release
          - debug

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # 第一步：克隆 linuxdeployqt 仓库并进入指定目录
      - name: Clone linuxdeployqt repository
        run: |
          git clone https://github.com/probonopd/linuxdeployqt.git
          cd linuxdeployqt/tools/linuxdeployqt
          git submodule update --init --recursive
          
      # 第二步：注释掉 glibc 版本检查代码
      - name: Disable glibc version check
        run: |
          cd linuxdeployqt/tools/linuxdeployqt
          # 使用 sed 命令注释掉指定的代码块
          sed -i '/if (strverscmp (glcv, "2.36") >= 0) {/,/^        }$/ s/^/\/\//' main.cpp
